* GENERATED BY CHARMM-GUI (http://www.charmm-gui.org) v3.1 on Nov, 19. 2020. JOBID=0577145999
* 

! Read topology and parameter files
stream toppar_drude.str

! Read PSF and Coordinates
open read unit 10 card name step2_drude.psf
read psf  unit 10 card

open read unit 10 card name step4_equilibration.crd
read coor unit 10 card

SHAKE bonh param nofast -
      select  .not. type D*  end -
      select  .not. type D*  end

stream step2_drude.str
stream checkfft.str

!
! Previous box information
!

calc pcnt = @cnt - 1
if pcnt .gt. 0 then
    bomlev -5
    open read  unit 11 card name step5_@pcnt.rst
    read coor dynr curr unit 11
    bomlev  0

    calc A = ?XTLA
    calc B = ?XTLB
    calc C = ?XTLC
endif

open read unit 10 card name crystal_image.str
CRYSTAL DEFINE @XTLtype @A @B @C @alpha @beta @gamma
CRYSTAL READ UNIT 10 CARD
image byres xcen 0.0 ycen 0.0 zcen 0.0 sele resn SWM4 end

!
! Nonbonded Options
!

nbonds atom vatom switch vswitch bycb -
       ctonnb 10.0 ctofnb 12.0 cutnb 16.0 cutim 16.0 LRC -
       inbfrq -1 imgfrq -1 wmin 1.0 cdie eps 1.0 -
       ewald pmew fftx @fftx ffty @ffty fftz @fftz  kappa .34 spline order 6
energy

!
!use a restraint to place center of mass of the molecules near the origin
!

MMFP
GEO rcm sphere -
    Xref @xcen Yref @ycen Zref @zcen XDIR 1.0 YDIR 1.0 ZDIR 1.0 -
    harmonic FORCE 1.0 select @prot .and. .not. hydrogen end
END

drudehardwall l_wall 0.2

set nstep = 1000000
set temp = 303.15

! Set up temperature control for the NPT simulation
bomlev -1
  TPCONTROL NTHER 2  CMDAMP 10.0  NSTEP 20  -
    THER 1 TAU  0.1   TREF @temp  SELECT .NOT. TYPE D* END  -
    THER 2 TAU  0.005 TREF 1.00   SELECT TYPE D* END  -
    BARO   BTAU 0.1   PREF 1.00   DSCY FULL

! open files for restart, trajectory and energies
calc pcnt = @cnt - 1
if pcnt .eq. 0 open read  unit 11 card name step4_equilibration.rst
if pcnt .gt. 0 open read  unit 11 card name step5_@pcnt.rst
open write unit 12 card name step5_@cnt.rst
open write unit 13 file name step5_@cnt.dcd

DYNA vv2 restart nstep @nstep timestep 0.001 -
     ntrfrq 10000 iprfrq -1 nprint 10000  -
     iasvel -1 firstt @temp finalt @temp -
     iseed 0577145999 ihbfrq 0 ilbfrq 0  -
     iunread 11 iunwrite 12 iuncrd 13 iunvel -1 kunit -1 -
     nsavc 10000 nsavv -1

open write unit 10 card name step5_@cnt.pdb
write coor unit 10 pdb
close unit 10

open write unit 10 card name step5_@cnt.crd
write coor unit 10 card
close unit 10

stop
